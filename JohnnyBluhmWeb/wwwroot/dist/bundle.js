(()=>{"use strict";var e=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))},t=function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(s){return function(u){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,s[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){a.label=s[1];break}if(6===s[0]&&a.label<o[1]){a.label=o[1],o=s;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(s);break}o[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}},n=function(){function n(){}return n.prototype.getPowerData=function(){return e(this,void 0,void 0,(function(){return t(this,(function(e){switch(e.label){case 0:return[4,fetch("https://localhost:7038/api/stravaMongo/GetAllPowerStreams")];case 1:return[4,e.sent().json()];case 2:return[2,e.sent()]}}))}))},n.prototype.getHeartRateData=function(){return e(this,void 0,void 0,(function(){return t(this,(function(e){switch(e.label){case 0:return[4,fetch("https://localhost:7038/api/stravaMongo/GetAllHrStreams")];case 1:return[4,e.sent().json()];case 2:return[2,e.sent()]}}))}))},n.prototype.getActivities=function(){return e(this,void 0,void 0,(function(){return t(this,(function(e){switch(e.label){case 0:return[4,fetch("https://localhost:7038/api/stravaMongo/GetAllActivities")];case 1:return[4,e.sent().json()];case 2:return[2,e.sent()]}}))}))},n.prototype.getDetailedActivities=function(){return e(this,void 0,void 0,(function(){return t(this,(function(e){switch(e.label){case 0:return[4,fetch("https://localhost:7038/api/stravaMongo/GetAllDetailedActivities")];case 1:return[4,e.sent().json()];case 2:return[2,e.sent()]}}))}))},n}();function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function o(e,t){if(t.length<e)throw new TypeError(e+" argument"+(e>1?"s":"")+" required, but only "+t.length+" present")}function i(e){o(1,arguments);var t=Object.prototype.toString.call(e);return e instanceof Date||"object"===r(e)&&"[object Date]"===t?new Date(e.getTime()):"number"==typeof e||"[object Number]"===t?new Date(e):("string"!=typeof e&&"[object String]"!==t||"undefined"==typeof console||(console.warn("Starting with v2.0.0-beta.1 date-fns doesn't accept strings as date arguments. Please use `parseISO` to parse strings. See: https://github.com/date-fns/date-fns/blob/master/docs/upgradeGuide.md#string-arguments"),console.warn((new Error).stack)),new Date(NaN))}function a(e,t){o(2,arguments);var n=i(e),r=i(t);return n.getTime()>r.getTime()}function s(e,t){o(2,arguments);var n=i(e),r=i(t);return n.getTime()<r.getTime()}var u=function(){function e(){}return e.prototype.getTimeInZoneList=function(e){for(var t={1:0,2:0,3:0,4:0,5:0,6:0,7:0},n=0,r=e;n<r.length;n++){var o=r[n];for(var i in o.powerStream){var a=o.powerStream[i];t[this.getZone(i).toString()]+=Number.parseInt(a)}}return Object.values(t)},e.prototype.getZone=function(e){var t=Number.parseInt(e);return t<=132?1:t>132&&t<=180?2:t>180&&t<=216?3:t>216&&t<=252?4:t>252&&t<=288?5:t>288&&t<=360?6:t>=360?7:1},e.prototype.setPowerZones=function(e){this.powerZones[0]=.55*e,this.powerZones[1]=.75*e,this.powerZones[2]=.87*e,this.powerZones[3]=1.05*e,this.powerZones[4]=1.2*e,this.powerZones[5]=1.5*e,this.powerZones[6]=2*e},e}(),c=function(){function e(){}return e.prototype.getTimeInZoneList=function(e){for(var t={1:0,2:0,3:0,4:0,5:0},n=0,r=e;n<r.length;n++){var o=r[n];for(var i in o.hrStream){var a=o.hrStream[i];t[this.getZone(i).toString()]+=Number.parseInt(a)}}return Object.values(t)},e.prototype.getZone=function(e){var t=Number.parseInt(e);return t<=118?1:t>118&&t<=156?2:t>156&&t<=175?3:t>175&&t<=194?4:t>194?5:1},e.prototype.setHrZones=function(e){this.hrZones[0]=.5*e,this.hrZones[1]=.6*e,this.hrZones[2]=.7*e,this.hrZones[3]=.8*e,this.hrZones[4]=.9*e},e}(),l=function(){function e(e){this.allActivities=e,this.filteredActivities=e}return e.prototype.filterByDate=function(e,t){this.filteredActivities=[];for(var n=0,r=this.allActivities;n<r.length;n++){var o=r[n],i=Date.parse(o.start_date_local);a(i,e)&&s(i,t)&&this.filteredActivities.push(o)}},e.prototype.setTimeInZoneLists=function(){this.powerTimeInZone=(new u).getTimeInZoneList(this.filteredActivities),this.hrTimeInZone=(new c).getTimeInZoneList(this.filteredActivities)},e.prototype.setCaloriesBurned=function(){this.caloriesBurnedInTimePeriod=0;for(var e=0,t=this.filteredActivities;e<t.length;e++){var n=t[e];this.caloriesBurnedInTimePeriod+=n.details.calories}},e}();function f(e){if(null===e||!0===e||!1===e)return NaN;var t=Number(e);return isNaN(t)?t:t<0?Math.ceil(t):Math.floor(t)}function h(e,t){return o(2,arguments),function(e,t){o(2,arguments);var n=i(e),r=f(t);return isNaN(r)?new Date(NaN):r?(n.setDate(n.getDate()+r),n):n}(e,-f(t))}function p(e,t){return o(2,arguments),function(e,t){return o(2,arguments),function(e,t){o(2,arguments);var n=i(e),r=f(t);if(isNaN(r))return new Date(NaN);if(!r)return n;var a=n.getDate(),s=new Date(n.getTime());return s.setMonth(n.getMonth()+r+1,0),a>=s.getDate()?s:(n.setFullYear(s.getFullYear(),s.getMonth(),a),n)}(e,12*f(t))}(e,-f(t))}var d=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))},v=function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(s){return function(u){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,s[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){a.label=s[1];break}if(6===s[0]&&a.label<o[1]){a.label=o[1],o=s;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(s);break}o[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}};function g(){return d(this,void 0,void 0,(function(){var e,t,r,o,i,a,s,u,c;return v(this,(function(f){switch(f.label){case 0:return document.getElementById("convertPower"),document.getElementById("convertHr"),[4,(e=new n).getPowerData()];case 1:return t=f.sent(),[4,e.getHeartRateData()];case 2:return r=f.sent(),[4,e.getActivities()];case 3:return o=f.sent(),[4,e.getDetailedActivities()];case 4:return i=f.sent(),console.log(o),console.log(i),console.log(r),console.log(t),function(e,t,n){for(var r=function(n){var r=t.find((function(e){return e.id==n.id})),o=e.find((function(e){return e.id==n.id}));n.powerStream=null==o?void 0:o.powerDict,n.hrStream=null==r?void 0:r.heartRateDict},o=0,i=n;o<i.length;o++)r(i[o])}(t,r,o),function(e,t){for(var n=function(e){var n=t.find((function(t){return t.id==e.id}));e.details=n},r=0,o=e;r<o.length;r++)n(o[r])}(o,i),console.log(o),(a=new l(o)).setTimeInZoneLists(),a.filterByDate(h(new Date,30),new Date),a.setCaloriesBurned(),console.log(a.caloriesBurnedInTimePeriod),a.filterByDate(h(new Date,90),new Date),s=a.hrTimeInZone,console.log("After 90 days filter"),a.setCaloriesBurned(),console.log(a.caloriesBurnedInTimePeriod),console.log(s),a.filterByDate(p(new Date,1),new Date),u=a.hrTimeInZone,console.log("After 1 year filter"),a.setCaloriesBurned(),console.log(a.caloriesBurnedInTimePeriod),console.log(u),a.filterByDate(p(new Date,5),new Date),c=a.hrTimeInZone,console.log("All time"),a.setCaloriesBurned(),console.log(a.caloriesBurnedInTimePeriod),console.log(c),[2]}}))}))}d(void 0,void 0,void 0,(function(){var e;return v(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,g()];case 1:return t.sent(),[3,3];case 2:return e=t.sent(),console.error(e),[3,3];case 3:return[2]}}))}))})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUNaRixFQUFleEQsYUFBYSxFQUFvQixJQUFJckMsS0FBUSxHQUFJLElBQUlBLE1BQ2hFZ0csRUFBZ0JILEVBQWUvQyxhQUNuQzVDLFFBQVFnRixJQUFJLHVCQUNaVyxFQUFlN0Msb0JBQ2Y5QyxRQUFRZ0YsSUFBSVcsRUFBZTVDLDRCQUMzQi9DLFFBQVFnRixJQUFJYyxHQUNaSCxFQUFleEQsYUFBYSxFQUFvQixJQUFJckMsS0FBUSxHQUFJLElBQUlBLE1BQ2hFaUcsRUFBa0JKLEVBQWUvQyxhQUNyQzVDLFFBQVFnRixJQUFJLFlBQ1pXLEVBQWU3QyxvQkFDZjlDLFFBQVFnRixJQUFJVyxFQUFlNUMsNEJBQzNCL0MsUUFBUWdGLElBQUllLEcsV0FtQmYsbUMsd0RBRU8sTyxzQkFBQSxHQUFNdkIsSyxjQUFOLFMsK0JBRUF4RSxRQUFRZ0csTUFBTSxHIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vc3RyYXZhLy4vc3JjL2FwaUNsaWVudC50cyIsIndlYnBhY2s6Ly9zdHJhdmEvLi9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vdHlwZW9mLmpzIiwid2VicGFjazovL3N0cmF2YS8uL25vZGVfbW9kdWxlcy9kYXRlLWZucy9lc20vX2xpYi9yZXF1aXJlZEFyZ3MvaW5kZXguanMiLCJ3ZWJwYWNrOi8vc3RyYXZhLy4vbm9kZV9tb2R1bGVzL2RhdGUtZm5zL2VzbS90b0RhdGUvaW5kZXguanMiLCJ3ZWJwYWNrOi8vc3RyYXZhLy4vbm9kZV9tb2R1bGVzL2RhdGUtZm5zL2VzbS9pc0FmdGVyL2luZGV4LmpzIiwid2VicGFjazovL3N0cmF2YS8uL25vZGVfbW9kdWxlcy9kYXRlLWZucy9lc20vaXNCZWZvcmUvaW5kZXguanMiLCJ3ZWJwYWNrOi8vc3RyYXZhLy4vc3JjL3Bvd2VyWm9uZUNhbGN1bGF0b3IudHMiLCJ3ZWJwYWNrOi8vc3RyYXZhLy4vc3JjL2hyWm9uZUNhbGN1bGF0b3IudHMiLCJ3ZWJwYWNrOi8vc3RyYXZhLy4vc3JjL2RhdGFDYWxjdWxhdG9yLnRzIiwid2VicGFjazovL3N0cmF2YS8uL25vZGVfbW9kdWxlcy9kYXRlLWZucy9lc20vX2xpYi90b0ludGVnZXIvaW5kZXguanMiLCJ3ZWJwYWNrOi8vc3RyYXZhLy4vbm9kZV9tb2R1bGVzL2RhdGUtZm5zL2VzbS9zdWJEYXlzL2luZGV4LmpzIiwid2VicGFjazovL3N0cmF2YS8uL25vZGVfbW9kdWxlcy9kYXRlLWZucy9lc20vYWRkRGF5cy9pbmRleC5qcyIsIndlYnBhY2s6Ly9zdHJhdmEvLi9ub2RlX21vZHVsZXMvZGF0ZS1mbnMvZXNtL3N1YlllYXJzL2luZGV4LmpzIiwid2VicGFjazovL3N0cmF2YS8uL25vZGVfbW9kdWxlcy9kYXRlLWZucy9lc20vYWRkWWVhcnMvaW5kZXguanMiLCJ3ZWJwYWNrOi8vc3RyYXZhLy4vbm9kZV9tb2R1bGVzL2RhdGUtZm5zL2VzbS9hZGRNb250aHMvaW5kZXguanMiLCJ3ZWJwYWNrOi8vc3RyYXZhLy4vc3JjL2luZGV4LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IERldGFpbGVkQWN0aXZpdHkgfSBmcm9tIFwiLi9tb2RlbHMvZGV0YWlsZWRBY3Rpdml0eVwiO1xyXG5pbXBvcnQgeyBTdHJhdmFBY3Rpdml0eSB9IGZyb20gXCIuL21vZGVscy9zdHJhdmFBY3Rpdml0eVwiO1xyXG5pbXBvcnQgeyBTdHJlYW0gfSBmcm9tIFwiLi9tb2RlbHMvc3RyZWFtXCI7XHJcblxyXG5leHBvcnQgY2xhc3MgU3RyYXZhQXBpQ2xpZW50IHtcclxuICAgIGNvbnN0cnVjdG9yKCkge1xyXG5cclxuICAgIH1cclxuICAgIGFzeW5jIGdldFBvd2VyRGF0YSgpOiBQcm9taXNlPFN0cmVhbVtdPiB7XHJcbiAgICAgICAgdmFyIHVybCA9IFwiaHR0cHM6Ly9sb2NhbGhvc3Q6NzAzOC9hcGkvc3RyYXZhTW9uZ28vR2V0QWxsUG93ZXJTdHJlYW1zXCI7XHJcblxyXG4gICAgICAgIHZhciByZXN1bHQgPSBhd2FpdCBmZXRjaCh1cmwpO1xyXG4gICAgICAgIHZhciBkYXRhID0gYXdhaXQgcmVzdWx0Lmpzb24oKSBhcyBTdHJlYW1bXTtcclxuICAgICAgICByZXR1cm4gZGF0YTtcclxuICAgIH1cclxuXHJcbiAgICBhc3luYyBnZXRIZWFydFJhdGVEYXRhKCk6IFByb21pc2U8U3RyZWFtW10+IHtcclxuICAgICAgICB2YXIgdXJsID0gXCJodHRwczovL2xvY2FsaG9zdDo3MDM4L2FwaS9zdHJhdmFNb25nby9HZXRBbGxIclN0cmVhbXNcIjtcclxuXHJcbiAgICAgICAgdmFyIHJlc3VsdCA9IGF3YWl0IGZldGNoKHVybCk7XHJcbiAgICAgICAgdmFyIGRhdGEgPSBhd2FpdCByZXN1bHQuanNvbigpIGFzIFN0cmVhbVtdO1xyXG4gICAgICAgIHJldHVybiBkYXRhO1xyXG4gICAgfVxyXG5cclxuICAgIGFzeW5jIGdldEFjdGl2aXRpZXMoKTogUHJvbWlzZTxTdHJhdmFBY3Rpdml0eVtdPiB7XHJcbiAgICAgICAgdmFyIHVybCA9IFwiaHR0cHM6Ly9sb2NhbGhvc3Q6NzAzOC9hcGkvc3RyYXZhTW9uZ28vR2V0QWxsQWN0aXZpdGllc1wiO1xyXG4gICAgICAgIHZhciByZXN1bHQgPSBhd2FpdCBmZXRjaCh1cmwpO1xyXG4gICAgICAgIHZhciBkYXRhID0gYXdhaXQgcmVzdWx0Lmpzb24oKSBhcyBTdHJhdmFBY3Rpdml0eVtdO1xyXG4gICAgICAgIHJldHVybiBkYXRhO1xyXG4gICAgfVxyXG5cclxuICAgIGFzeW5jIGdldERldGFpbGVkQWN0aXZpdGllcygpOiBQcm9taXNlPERldGFpbGVkQWN0aXZpdHlbXT4ge1xyXG4gICAgICAgIHZhciB1cmwgPSBcImh0dHBzOi8vbG9jYWxob3N0OjcwMzgvYXBpL3N0cmF2YU1vbmdvL0dldEFsbERldGFpbGVkQWN0aXZpdGllc1wiO1xyXG4gICAgICAgIHZhciByZXN1bHQgPSBhd2FpdCBmZXRjaCh1cmwpO1xyXG4gICAgICAgIHZhciBkYXRhID0gYXdhaXQgcmVzdWx0Lmpzb24oKSBhcyBEZXRhaWxlZEFjdGl2aXR5W107XHJcbiAgICAgICAgcmV0dXJuIGRhdGE7XHJcbiAgICB9XHJcbn0iLCJleHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBfdHlwZW9mKG9iaikge1xuICBcIkBiYWJlbC9oZWxwZXJzIC0gdHlwZW9mXCI7XG5cbiAgcmV0dXJuIF90eXBlb2YgPSBcImZ1bmN0aW9uXCIgPT0gdHlwZW9mIFN5bWJvbCAmJiBcInN5bWJvbFwiID09IHR5cGVvZiBTeW1ib2wuaXRlcmF0b3IgPyBmdW5jdGlvbiAob2JqKSB7XG4gICAgcmV0dXJuIHR5cGVvZiBvYmo7XG4gIH0gOiBmdW5jdGlvbiAob2JqKSB7XG4gICAgcmV0dXJuIG9iaiAmJiBcImZ1bmN0aW9uXCIgPT0gdHlwZW9mIFN5bWJvbCAmJiBvYmouY29uc3RydWN0b3IgPT09IFN5bWJvbCAmJiBvYmogIT09IFN5bWJvbC5wcm90b3R5cGUgPyBcInN5bWJvbFwiIDogdHlwZW9mIG9iajtcbiAgfSwgX3R5cGVvZihvYmopO1xufSIsImV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIHJlcXVpcmVkQXJncyhyZXF1aXJlZCwgYXJncykge1xuICBpZiAoYXJncy5sZW5ndGggPCByZXF1aXJlZCkge1xuICAgIHRocm93IG5ldyBUeXBlRXJyb3IocmVxdWlyZWQgKyAnIGFyZ3VtZW50JyArIChyZXF1aXJlZCA+IDEgPyAncycgOiAnJykgKyAnIHJlcXVpcmVkLCBidXQgb25seSAnICsgYXJncy5sZW5ndGggKyAnIHByZXNlbnQnKTtcbiAgfVxufSIsImltcG9ydCBfdHlwZW9mIGZyb20gXCJAYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS90eXBlb2ZcIjtcbmltcG9ydCByZXF1aXJlZEFyZ3MgZnJvbSBcIi4uL19saWIvcmVxdWlyZWRBcmdzL2luZGV4LmpzXCI7XG4vKipcbiAqIEBuYW1lIHRvRGF0ZVxuICogQGNhdGVnb3J5IENvbW1vbiBIZWxwZXJzXG4gKiBAc3VtbWFyeSBDb252ZXJ0IHRoZSBnaXZlbiBhcmd1bWVudCB0byBhbiBpbnN0YW5jZSBvZiBEYXRlLlxuICpcbiAqIEBkZXNjcmlwdGlvblxuICogQ29udmVydCB0aGUgZ2l2ZW4gYXJndW1lbnQgdG8gYW4gaW5zdGFuY2Ugb2YgRGF0ZS5cbiAqXG4gKiBJZiB0aGUgYXJndW1lbnQgaXMgYW4gaW5zdGFuY2Ugb2YgRGF0ZSwgdGhlIGZ1bmN0aW9uIHJldHVybnMgaXRzIGNsb25lLlxuICpcbiAqIElmIHRoZSBhcmd1bWVudCBpcyBhIG51bWJlciwgaXQgaXMgdHJlYXRlZCBhcyBhIHRpbWVzdGFtcC5cbiAqXG4gKiBJZiB0aGUgYXJndW1lbnQgaXMgbm9uZSBvZiB0aGUgYWJvdmUsIHRoZSBmdW5jdGlvbiByZXR1cm5zIEludmFsaWQgRGF0ZS5cbiAqXG4gKiAqKk5vdGUqKjogKmFsbCogRGF0ZSBhcmd1bWVudHMgcGFzc2VkIHRvIGFueSAqZGF0ZS1mbnMqIGZ1bmN0aW9uIGlzIHByb2Nlc3NlZCBieSBgdG9EYXRlYC5cbiAqXG4gKiBAcGFyYW0ge0RhdGV8TnVtYmVyfSBhcmd1bWVudCAtIHRoZSB2YWx1ZSB0byBjb252ZXJ0XG4gKiBAcmV0dXJucyB7RGF0ZX0gdGhlIHBhcnNlZCBkYXRlIGluIHRoZSBsb2NhbCB0aW1lIHpvbmVcbiAqIEB0aHJvd3Mge1R5cGVFcnJvcn0gMSBhcmd1bWVudCByZXF1aXJlZFxuICpcbiAqIEBleGFtcGxlXG4gKiAvLyBDbG9uZSB0aGUgZGF0ZTpcbiAqIGNvbnN0IHJlc3VsdCA9IHRvRGF0ZShuZXcgRGF0ZSgyMDE0LCAxLCAxMSwgMTEsIDMwLCAzMCkpXG4gKiAvLz0+IFR1ZSBGZWIgMTEgMjAxNCAxMTozMDozMFxuICpcbiAqIEBleGFtcGxlXG4gKiAvLyBDb252ZXJ0IHRoZSB0aW1lc3RhbXAgdG8gZGF0ZTpcbiAqIGNvbnN0IHJlc3VsdCA9IHRvRGF0ZSgxMzkyMDk4NDMwMDAwKVxuICogLy89PiBUdWUgRmViIDExIDIwMTQgMTE6MzA6MzBcbiAqL1xuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gdG9EYXRlKGFyZ3VtZW50KSB7XG4gIHJlcXVpcmVkQXJncygxLCBhcmd1bWVudHMpO1xuICB2YXIgYXJnU3RyID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKGFyZ3VtZW50KTtcblxuICAvLyBDbG9uZSB0aGUgZGF0ZVxuICBpZiAoYXJndW1lbnQgaW5zdGFuY2VvZiBEYXRlIHx8IF90eXBlb2YoYXJndW1lbnQpID09PSAnb2JqZWN0JyAmJiBhcmdTdHIgPT09ICdbb2JqZWN0IERhdGVdJykge1xuICAgIC8vIFByZXZlbnQgdGhlIGRhdGUgdG8gbG9zZSB0aGUgbWlsbGlzZWNvbmRzIHdoZW4gcGFzc2VkIHRvIG5ldyBEYXRlKCkgaW4gSUUxMFxuICAgIHJldHVybiBuZXcgRGF0ZShhcmd1bWVudC5nZXRUaW1lKCkpO1xuICB9IGVsc2UgaWYgKHR5cGVvZiBhcmd1bWVudCA9PT0gJ251bWJlcicgfHwgYXJnU3RyID09PSAnW29iamVjdCBOdW1iZXJdJykge1xuICAgIHJldHVybiBuZXcgRGF0ZShhcmd1bWVudCk7XG4gIH0gZWxzZSB7XG4gICAgaWYgKCh0eXBlb2YgYXJndW1lbnQgPT09ICdzdHJpbmcnIHx8IGFyZ1N0ciA9PT0gJ1tvYmplY3QgU3RyaW5nXScpICYmIHR5cGVvZiBjb25zb2xlICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLWNvbnNvbGVcbiAgICAgIGNvbnNvbGUud2FybihcIlN0YXJ0aW5nIHdpdGggdjIuMC4wLWJldGEuMSBkYXRlLWZucyBkb2Vzbid0IGFjY2VwdCBzdHJpbmdzIGFzIGRhdGUgYXJndW1lbnRzLiBQbGVhc2UgdXNlIGBwYXJzZUlTT2AgdG8gcGFyc2Ugc3RyaW5ncy4gU2VlOiBodHRwczovL2dpdGh1Yi5jb20vZGF0ZS1mbnMvZGF0ZS1mbnMvYmxvYi9tYXN0ZXIvZG9jcy91cGdyYWRlR3VpZGUubWQjc3RyaW5nLWFyZ3VtZW50c1wiKTtcbiAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1jb25zb2xlXG4gICAgICBjb25zb2xlLndhcm4obmV3IEVycm9yKCkuc3RhY2spO1xuICAgIH1cbiAgICByZXR1cm4gbmV3IERhdGUoTmFOKTtcbiAgfVxufSIsImltcG9ydCB0b0RhdGUgZnJvbSBcIi4uL3RvRGF0ZS9pbmRleC5qc1wiO1xuaW1wb3J0IHJlcXVpcmVkQXJncyBmcm9tIFwiLi4vX2xpYi9yZXF1aXJlZEFyZ3MvaW5kZXguanNcIjtcbi8qKlxuICogQG5hbWUgaXNBZnRlclxuICogQGNhdGVnb3J5IENvbW1vbiBIZWxwZXJzXG4gKiBAc3VtbWFyeSBJcyB0aGUgZmlyc3QgZGF0ZSBhZnRlciB0aGUgc2Vjb25kIG9uZT9cbiAqXG4gKiBAZGVzY3JpcHRpb25cbiAqIElzIHRoZSBmaXJzdCBkYXRlIGFmdGVyIHRoZSBzZWNvbmQgb25lP1xuICpcbiAqIEBwYXJhbSB7RGF0ZXxOdW1iZXJ9IGRhdGUgLSB0aGUgZGF0ZSB0aGF0IHNob3VsZCBiZSBhZnRlciB0aGUgb3RoZXIgb25lIHRvIHJldHVybiB0cnVlXG4gKiBAcGFyYW0ge0RhdGV8TnVtYmVyfSBkYXRlVG9Db21wYXJlIC0gdGhlIGRhdGUgdG8gY29tcGFyZSB3aXRoXG4gKiBAcmV0dXJucyB7Qm9vbGVhbn0gdGhlIGZpcnN0IGRhdGUgaXMgYWZ0ZXIgdGhlIHNlY29uZCBkYXRlXG4gKiBAdGhyb3dzIHtUeXBlRXJyb3J9IDIgYXJndW1lbnRzIHJlcXVpcmVkXG4gKlxuICogQGV4YW1wbGVcbiAqIC8vIElzIDEwIEp1bHkgMTk4OSBhZnRlciAxMSBGZWJydWFyeSAxOTg3P1xuICogY29uc3QgcmVzdWx0ID0gaXNBZnRlcihuZXcgRGF0ZSgxOTg5LCA2LCAxMCksIG5ldyBEYXRlKDE5ODcsIDEsIDExKSlcbiAqIC8vPT4gdHJ1ZVxuICovXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBpc0FmdGVyKGRpcnR5RGF0ZSwgZGlydHlEYXRlVG9Db21wYXJlKSB7XG4gIHJlcXVpcmVkQXJncygyLCBhcmd1bWVudHMpO1xuICB2YXIgZGF0ZSA9IHRvRGF0ZShkaXJ0eURhdGUpO1xuICB2YXIgZGF0ZVRvQ29tcGFyZSA9IHRvRGF0ZShkaXJ0eURhdGVUb0NvbXBhcmUpO1xuICByZXR1cm4gZGF0ZS5nZXRUaW1lKCkgPiBkYXRlVG9Db21wYXJlLmdldFRpbWUoKTtcbn0iLCJpbXBvcnQgdG9EYXRlIGZyb20gXCIuLi90b0RhdGUvaW5kZXguanNcIjtcbmltcG9ydCByZXF1aXJlZEFyZ3MgZnJvbSBcIi4uL19saWIvcmVxdWlyZWRBcmdzL2luZGV4LmpzXCI7XG4vKipcbiAqIEBuYW1lIGlzQmVmb3JlXG4gKiBAY2F0ZWdvcnkgQ29tbW9uIEhlbHBlcnNcbiAqIEBzdW1tYXJ5IElzIHRoZSBmaXJzdCBkYXRlIGJlZm9yZSB0aGUgc2Vjb25kIG9uZT9cbiAqXG4gKiBAZGVzY3JpcHRpb25cbiAqIElzIHRoZSBmaXJzdCBkYXRlIGJlZm9yZSB0aGUgc2Vjb25kIG9uZT9cbiAqXG4gKiBAcGFyYW0ge0RhdGV8TnVtYmVyfSBkYXRlIC0gdGhlIGRhdGUgdGhhdCBzaG91bGQgYmUgYmVmb3JlIHRoZSBvdGhlciBvbmUgdG8gcmV0dXJuIHRydWVcbiAqIEBwYXJhbSB7RGF0ZXxOdW1iZXJ9IGRhdGVUb0NvbXBhcmUgLSB0aGUgZGF0ZSB0byBjb21wYXJlIHdpdGhcbiAqIEByZXR1cm5zIHtCb29sZWFufSB0aGUgZmlyc3QgZGF0ZSBpcyBiZWZvcmUgdGhlIHNlY29uZCBkYXRlXG4gKiBAdGhyb3dzIHtUeXBlRXJyb3J9IDIgYXJndW1lbnRzIHJlcXVpcmVkXG4gKlxuICogQGV4YW1wbGVcbiAqIC8vIElzIDEwIEp1bHkgMTk4OSBiZWZvcmUgMTEgRmVicnVhcnkgMTk4Nz9cbiAqIGNvbnN0IHJlc3VsdCA9IGlzQmVmb3JlKG5ldyBEYXRlKDE5ODksIDYsIDEwKSwgbmV3IERhdGUoMTk4NywgMSwgMTEpKVxuICogLy89PiBmYWxzZVxuICovXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBpc0JlZm9yZShkaXJ0eURhdGUsIGRpcnR5RGF0ZVRvQ29tcGFyZSkge1xuICByZXF1aXJlZEFyZ3MoMiwgYXJndW1lbnRzKTtcbiAgdmFyIGRhdGUgPSB0b0RhdGUoZGlydHlEYXRlKTtcbiAgdmFyIGRhdGVUb0NvbXBhcmUgPSB0b0RhdGUoZGlydHlEYXRlVG9Db21wYXJlKTtcbiAgcmV0dXJuIGRhdGUuZ2V0VGltZSgpIDwgZGF0ZVRvQ29tcGFyZS5nZXRUaW1lKCk7XG59IiwiaW1wb3J0IHsgQ2hhcnQsIENoYXJ0Q29uZmlndXJhdGlvbiwgQ2hhcnRJdGVtLCBDaGFydFR5cGUsIENoYXJ0VHlwZVJlZ2lzdHJ5IH0gZnJvbSBcImNoYXJ0LmpzL2F1dG9cIjtcclxuaW1wb3J0IHsgQ2hhcnRHZW5lcmF0b3IgfSBmcm9tIFwiLi9jaGFydEdlbmVyYXRvclwiO1xyXG5pbXBvcnQgeyBTdHJhdmFBY3Rpdml0eSB9IGZyb20gXCIuL21vZGVscy9zdHJhdmFBY3Rpdml0eVwiO1xyXG5pbXBvcnQgeyBTdHJlYW0gfSBmcm9tIFwiLi9tb2RlbHMvc3RyZWFtXCI7XHJcblxyXG5leHBvcnQgY2xhc3MgUG93ZXJab25lIHtcclxuICAgIHBvd2VyWm9uZXM6IG51bWJlcltdO1xyXG5cclxuICAgIHB1YmxpYyBnZXRUaW1lSW5ab25lTGlzdChhY3Rpdml0aWVzOiBTdHJhdmFBY3Rpdml0eVtdKTogbnVtYmVyW10ge1xyXG4gICAgICAgIGxldCB0aW1lSW5ab25lRGljdDogeyBbaW5kZXg6IHN0cmluZ106IG51bWJlciB9ID0ge1xyXG4gICAgICAgICAgICBcIjFcIjogMCxcclxuICAgICAgICAgICAgXCIyXCI6IDAsXHJcbiAgICAgICAgICAgIFwiM1wiOiAwLFxyXG4gICAgICAgICAgICBcIjRcIjogMCxcclxuICAgICAgICAgICAgXCI1XCI6IDAsXHJcbiAgICAgICAgICAgIFwiNlwiOiAwLFxyXG4gICAgICAgICAgICBcIjdcIjogMCxcclxuICAgICAgICB9O1xyXG4gICAgICAgIGZvciAobGV0IGFjdGl2aXR5IG9mIGFjdGl2aXRpZXMpIHtcclxuICAgICAgICAgICAgZm9yIChsZXQga2V5IGluIGFjdGl2aXR5LnBvd2VyU3RyZWFtKSB7XHJcbiAgICAgICAgICAgICAgICBsZXQgdGltZUF0UG93ZXJJblNlY29uZHMgPSBhY3Rpdml0eS5wb3dlclN0cmVhbVtrZXldO1xyXG4gICAgICAgICAgICAgICAgbGV0IHpvbmUgPSB0aGlzLmdldFpvbmUoa2V5KTtcclxuICAgICAgICAgICAgICAgIGxldCB6b25lU3RyaW5nID0gem9uZS50b1N0cmluZygpIGFzIHN0cmluZztcclxuICAgICAgICAgICAgICAgIHRpbWVJblpvbmVEaWN0W3pvbmVTdHJpbmddICs9IE51bWJlci5wYXJzZUludCh0aW1lQXRQb3dlckluU2Vjb25kcyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBPYmplY3QudmFsdWVzKHRpbWVJblpvbmVEaWN0KTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGdldFpvbmUocG93ZXI6IHN0cmluZyk6IG51bWJlciB7XHJcbiAgICAgICAgdmFyIHBvd2VyQXNOdW1iZXIgPSBOdW1iZXIucGFyc2VJbnQocG93ZXIpO1xyXG4gICAgICAgIGlmIChwb3dlckFzTnVtYmVyIDw9IDEzMikge1xyXG4gICAgICAgICAgICByZXR1cm4gMTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAocG93ZXJBc051bWJlciA+IDEzMiAmJiBwb3dlckFzTnVtYmVyIDw9IDE4MCkge1xyXG4gICAgICAgICAgICByZXR1cm4gMjtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAocG93ZXJBc051bWJlciA+IDE4MCAmJiBwb3dlckFzTnVtYmVyIDw9IDIxNikge1xyXG4gICAgICAgICAgICByZXR1cm4gMztcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAocG93ZXJBc051bWJlciA+IDIxNiAmJiBwb3dlckFzTnVtYmVyIDw9IDI1Mikge1xyXG4gICAgICAgICAgICByZXR1cm4gNDtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAocG93ZXJBc051bWJlciA+IDI1MiAmJiBwb3dlckFzTnVtYmVyIDw9IDI4OCkge1xyXG4gICAgICAgICAgICByZXR1cm4gNTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAocG93ZXJBc051bWJlciA+IDI4OCAmJiBwb3dlckFzTnVtYmVyIDw9IDM2MCkge1xyXG4gICAgICAgICAgICByZXR1cm4gNjtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAocG93ZXJBc051bWJlciA+PSAzNjApIHtcclxuICAgICAgICAgICAgcmV0dXJuIDc7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiAxO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgc2V0UG93ZXJab25lcyhmdHA6IG51bWJlcikge1xyXG4gICAgICAgIHRoaXMucG93ZXJab25lc1swXSA9IGZ0cCAqIC41NTtcclxuICAgICAgICB0aGlzLnBvd2VyWm9uZXNbMV0gPSBmdHAgKiAuNzU7XHJcbiAgICAgICAgdGhpcy5wb3dlclpvbmVzWzJdID0gZnRwICogLjg3O1xyXG4gICAgICAgIHRoaXMucG93ZXJab25lc1szXSA9IGZ0cCAqIDEuMDU7XHJcbiAgICAgICAgdGhpcy5wb3dlclpvbmVzWzRdID0gZnRwICogMS4yO1xyXG4gICAgICAgIHRoaXMucG93ZXJab25lc1s1XSA9IGZ0cCAqIDEuNTtcclxuICAgICAgICB0aGlzLnBvd2VyWm9uZXNbNl0gPSBmdHAgKiAyO1xyXG4gICAgfVxyXG59IiwiaW1wb3J0IHsgQ2hhcnQsIENoYXJ0Q29uZmlndXJhdGlvbiwgQ2hhcnRJdGVtLCBDaGFydFR5cGUsIENoYXJ0VHlwZVJlZ2lzdHJ5IH0gZnJvbSBcImNoYXJ0LmpzL2F1dG9cIjtcclxuaW1wb3J0IHsgQ2hhcnRHZW5lcmF0b3IgfSBmcm9tIFwiLi9jaGFydEdlbmVyYXRvclwiO1xyXG5pbXBvcnQgeyBTdHJhdmFBY3Rpdml0eSB9IGZyb20gXCIuL21vZGVscy9zdHJhdmFBY3Rpdml0eVwiO1xyXG5pbXBvcnQgeyBTdHJlYW0gfSBmcm9tIFwiLi9tb2RlbHMvc3RyZWFtXCI7XHJcblxyXG5leHBvcnQgY2xhc3MgSHJab25lIHtcclxuICAgIGhyWm9uZXM6IG51bWJlcltdO1xyXG5cclxuICAgIHB1YmxpYyBnZXRUaW1lSW5ab25lTGlzdChhY3Rpdml0aWVzOiBTdHJhdmFBY3Rpdml0eVtdKTogbnVtYmVyW10ge1xyXG4gICAgICAgIGxldCB0aW1lSW5ab25lRGljdDogeyBbaW5kZXg6IHN0cmluZ106IG51bWJlciB9ID0ge1xyXG4gICAgICAgICAgICBcIjFcIjogMCxcclxuICAgICAgICAgICAgXCIyXCI6IDAsXHJcbiAgICAgICAgICAgIFwiM1wiOiAwLFxyXG4gICAgICAgICAgICBcIjRcIjogMCxcclxuICAgICAgICAgICAgXCI1XCI6IDAsXHJcbiAgICAgICAgfTtcclxuICAgICAgICBmb3IgKGxldCBhY3Rpdml0eSBvZiBhY3Rpdml0aWVzKSB7XHJcbiAgICAgICAgICAgIGZvciAobGV0IGtleSBpbiBhY3Rpdml0eS5oclN0cmVhbSkge1xyXG4gICAgICAgICAgICAgICAgbGV0IHRpbWVBdFBvd2VySW5TZWNvbmRzID0gYWN0aXZpdHkuaHJTdHJlYW1ba2V5XTtcclxuICAgICAgICAgICAgICAgIGxldCB6b25lID0gdGhpcy5nZXRab25lKGtleSk7XHJcbiAgICAgICAgICAgICAgICBsZXQgem9uZVN0cmluZyA9IHpvbmUudG9TdHJpbmcoKSBhcyBzdHJpbmc7XHJcbiAgICAgICAgICAgICAgICB0aW1lSW5ab25lRGljdFt6b25lU3RyaW5nXSArPSBOdW1iZXIucGFyc2VJbnQodGltZUF0UG93ZXJJblNlY29uZHMpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gT2JqZWN0LnZhbHVlcyh0aW1lSW5ab25lRGljdCk7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0Wm9uZShoZWFydFJhdGU6IHN0cmluZyk6IG51bWJlciB7XHJcbiAgICAgICAgdmFyIHBvd2VyQXNOdW1iZXIgPSBOdW1iZXIucGFyc2VJbnQoaGVhcnRSYXRlKTtcclxuICAgICAgICBpZiAocG93ZXJBc051bWJlciA8PSAxMTgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIDE7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKHBvd2VyQXNOdW1iZXIgPiAxMTggJiYgcG93ZXJBc051bWJlciA8PSAxNTYpIHtcclxuICAgICAgICAgICAgcmV0dXJuIDI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKHBvd2VyQXNOdW1iZXIgPiAxNTYgJiYgcG93ZXJBc051bWJlciA8PSAxNzUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIDM7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKHBvd2VyQXNOdW1iZXIgPiAxNzUgJiYgcG93ZXJBc051bWJlciA8PSAxOTQpIHtcclxuICAgICAgICAgICAgcmV0dXJuIDQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKHBvd2VyQXNOdW1iZXIgPiAxOTQpIHtcclxuICAgICAgICAgICAgcmV0dXJuIDU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiAxO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgc2V0SHJab25lcyhtYXhIcjogbnVtYmVyKSB7XHJcbiAgICAgICAgdGhpcy5oclpvbmVzWzBdID0gbWF4SHIgKiAuNTtcclxuICAgICAgICB0aGlzLmhyWm9uZXNbMV0gPSBtYXhIciAqIC42O1xyXG4gICAgICAgIHRoaXMuaHJab25lc1syXSA9IG1heEhyICogLjc7XHJcbiAgICAgICAgdGhpcy5oclpvbmVzWzNdID0gbWF4SHIgKiAuODtcclxuICAgICAgICB0aGlzLmhyWm9uZXNbNF0gPSBtYXhIciAqIC45O1xyXG4gICAgfVxyXG5cclxufSIsImltcG9ydCB7IENoYXJ0LCBDaGFydENvbmZpZ3VyYXRpb24sIENoYXJ0SXRlbSwgQ2hhcnRUeXBlIH0gZnJvbSBcImNoYXJ0LmpzL2F1dG9cIjtcclxuaW1wb3J0IHsgQ2hhcnRHZW5lcmF0b3IgfSBmcm9tIFwiLi9jaGFydEdlbmVyYXRvclwiO1xyXG5pbXBvcnQgeyBTdHJhdmFBY3Rpdml0eSB9IGZyb20gXCIuL21vZGVscy9zdHJhdmFBY3Rpdml0eVwiO1xyXG5pbXBvcnQgeyBTdHJlYW0gfSBmcm9tIFwiLi9tb2RlbHMvc3RyZWFtXCI7XHJcbmltcG9ydCB7IFRpbWVJblpvbmVGaWx0ZXIgfSBmcm9tIFwiLi90aW1lSW5ab25lRmlsdGVyXCI7XHJcbmltcG9ydCAqIGFzIERhdGVIZWxwZXIgZnJvbSAnZGF0ZS1mbnMnO1xyXG5pbXBvcnQgeyBQb3dlclpvbmUgfSBmcm9tIFwiLi9wb3dlclpvbmVDYWxjdWxhdG9yXCI7XHJcbmltcG9ydCB7IEhyWm9uZSB9IGZyb20gXCIuL2hyWm9uZUNhbGN1bGF0b3JcIjtcclxuXHJcbmV4cG9ydCBjbGFzcyBEYXRhQ2FsY3VsYXRvciB7XHJcbiAgICBhbGxBY3Rpdml0aWVzOiBTdHJhdmFBY3Rpdml0eVtdO1xyXG4gICAgZmlsdGVyZWRBY3Rpdml0aWVzOiBTdHJhdmFBY3Rpdml0eVtdO1xyXG5cclxuICAgIGhyVGltZUluWm9uZTogbnVtYmVyW107XHJcbiAgICBwb3dlclRpbWVJblpvbmU6IG51bWJlcltdXHJcbiAgICBjYWxvcmllc0J1cm5lZEluVGltZVBlcmlvZDogbnVtYmVyO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKGFjdGl2aXRpZXM6IFN0cmF2YUFjdGl2aXR5W10pIHtcclxuICAgICAgICB0aGlzLmFsbEFjdGl2aXRpZXMgPSBhY3Rpdml0aWVzO1xyXG4gICAgICAgIHRoaXMuZmlsdGVyZWRBY3Rpdml0aWVzID0gYWN0aXZpdGllcztcclxuICAgIH1cclxuXHJcbiAgICBmaWx0ZXJCeURhdGUoZnJvbURhdGU6IERhdGUsIHRvRGF0ZTogRGF0ZSkge1xyXG4gICAgICAgIHRoaXMuZmlsdGVyZWRBY3Rpdml0aWVzID0gW107XHJcbiAgICAgICAgZm9yIChsZXQgYWN0aXZpdHkgb2YgdGhpcy5hbGxBY3Rpdml0aWVzKSB7XHJcbiAgICAgICAgICAgIGxldCBhY3Rpdml0eURhdGUgPSBEYXRlLnBhcnNlKGFjdGl2aXR5LnN0YXJ0X2RhdGVfbG9jYWwpO1xyXG4gICAgICAgICAgICBpZiAoRGF0ZUhlbHBlci5pc0FmdGVyKGFjdGl2aXR5RGF0ZSwgZnJvbURhdGUpICYmIERhdGVIZWxwZXIuaXNCZWZvcmUoYWN0aXZpdHlEYXRlLCB0b0RhdGUpKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmZpbHRlcmVkQWN0aXZpdGllcy5wdXNoKGFjdGl2aXR5KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBzZXRUaW1lSW5ab25lTGlzdHMoKSB7XHJcbiAgICAgICAgdGhpcy5wb3dlclRpbWVJblpvbmUgPSBuZXcgUG93ZXJab25lKCkuZ2V0VGltZUluWm9uZUxpc3QodGhpcy5maWx0ZXJlZEFjdGl2aXRpZXMpO1xyXG4gICAgICAgIHRoaXMuaHJUaW1lSW5ab25lID0gbmV3IEhyWm9uZSgpLmdldFRpbWVJblpvbmVMaXN0KHRoaXMuZmlsdGVyZWRBY3Rpdml0aWVzKTtcclxuICAgIH1cclxuXHJcbiAgICBzZXRDYWxvcmllc0J1cm5lZCgpIHtcclxuICAgICAgICB0aGlzLmNhbG9yaWVzQnVybmVkSW5UaW1lUGVyaW9kID0gMDtcclxuICAgICAgICBmb3IgKGxldCBhY3Rpdml0eSBvZiB0aGlzLmZpbHRlcmVkQWN0aXZpdGllcykge1xyXG4gICAgICAgICAgICB0aGlzLmNhbG9yaWVzQnVybmVkSW5UaW1lUGVyaW9kICs9IGFjdGl2aXR5LmRldGFpbHMuY2Fsb3JpZXM7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59IiwiZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gdG9JbnRlZ2VyKGRpcnR5TnVtYmVyKSB7XG4gIGlmIChkaXJ0eU51bWJlciA9PT0gbnVsbCB8fCBkaXJ0eU51bWJlciA9PT0gdHJ1ZSB8fCBkaXJ0eU51bWJlciA9PT0gZmFsc2UpIHtcbiAgICByZXR1cm4gTmFOO1xuICB9XG4gIHZhciBudW1iZXIgPSBOdW1iZXIoZGlydHlOdW1iZXIpO1xuICBpZiAoaXNOYU4obnVtYmVyKSkge1xuICAgIHJldHVybiBudW1iZXI7XG4gIH1cbiAgcmV0dXJuIG51bWJlciA8IDAgPyBNYXRoLmNlaWwobnVtYmVyKSA6IE1hdGguZmxvb3IobnVtYmVyKTtcbn0iLCJpbXBvcnQgYWRkRGF5cyBmcm9tIFwiLi4vYWRkRGF5cy9pbmRleC5qc1wiO1xuaW1wb3J0IHJlcXVpcmVkQXJncyBmcm9tIFwiLi4vX2xpYi9yZXF1aXJlZEFyZ3MvaW5kZXguanNcIjtcbmltcG9ydCB0b0ludGVnZXIgZnJvbSBcIi4uL19saWIvdG9JbnRlZ2VyL2luZGV4LmpzXCI7XG4vKipcbiAqIEBuYW1lIHN1YkRheXNcbiAqIEBjYXRlZ29yeSBEYXkgSGVscGVyc1xuICogQHN1bW1hcnkgU3VidHJhY3QgdGhlIHNwZWNpZmllZCBudW1iZXIgb2YgZGF5cyBmcm9tIHRoZSBnaXZlbiBkYXRlLlxuICpcbiAqIEBkZXNjcmlwdGlvblxuICogU3VidHJhY3QgdGhlIHNwZWNpZmllZCBudW1iZXIgb2YgZGF5cyBmcm9tIHRoZSBnaXZlbiBkYXRlLlxuICpcbiAqIEBwYXJhbSB7RGF0ZXxOdW1iZXJ9IGRhdGUgLSB0aGUgZGF0ZSB0byBiZSBjaGFuZ2VkXG4gKiBAcGFyYW0ge051bWJlcn0gYW1vdW50IC0gdGhlIGFtb3VudCBvZiBkYXlzIHRvIGJlIHN1YnRyYWN0ZWQuIFBvc2l0aXZlIGRlY2ltYWxzIHdpbGwgYmUgcm91bmRlZCB1c2luZyBgTWF0aC5mbG9vcmAsIGRlY2ltYWxzIGxlc3MgdGhhbiB6ZXJvIHdpbGwgYmUgcm91bmRlZCB1c2luZyBgTWF0aC5jZWlsYC5cbiAqIEByZXR1cm5zIHtEYXRlfSB0aGUgbmV3IGRhdGUgd2l0aCB0aGUgZGF5cyBzdWJ0cmFjdGVkXG4gKiBAdGhyb3dzIHtUeXBlRXJyb3J9IDIgYXJndW1lbnRzIHJlcXVpcmVkXG4gKlxuICogQGV4YW1wbGVcbiAqIC8vIFN1YnRyYWN0IDEwIGRheXMgZnJvbSAxIFNlcHRlbWJlciAyMDE0OlxuICogY29uc3QgcmVzdWx0ID0gc3ViRGF5cyhuZXcgRGF0ZSgyMDE0LCA4LCAxKSwgMTApXG4gKiAvLz0+IEZyaSBBdWcgMjIgMjAxNCAwMDowMDowMFxuICovXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBzdWJEYXlzKGRpcnR5RGF0ZSwgZGlydHlBbW91bnQpIHtcbiAgcmVxdWlyZWRBcmdzKDIsIGFyZ3VtZW50cyk7XG4gIHZhciBhbW91bnQgPSB0b0ludGVnZXIoZGlydHlBbW91bnQpO1xuICByZXR1cm4gYWRkRGF5cyhkaXJ0eURhdGUsIC1hbW91bnQpO1xufSIsImltcG9ydCB0b0ludGVnZXIgZnJvbSBcIi4uL19saWIvdG9JbnRlZ2VyL2luZGV4LmpzXCI7XG5pbXBvcnQgdG9EYXRlIGZyb20gXCIuLi90b0RhdGUvaW5kZXguanNcIjtcbmltcG9ydCByZXF1aXJlZEFyZ3MgZnJvbSBcIi4uL19saWIvcmVxdWlyZWRBcmdzL2luZGV4LmpzXCI7XG4vKipcbiAqIEBuYW1lIGFkZERheXNcbiAqIEBjYXRlZ29yeSBEYXkgSGVscGVyc1xuICogQHN1bW1hcnkgQWRkIHRoZSBzcGVjaWZpZWQgbnVtYmVyIG9mIGRheXMgdG8gdGhlIGdpdmVuIGRhdGUuXG4gKlxuICogQGRlc2NyaXB0aW9uXG4gKiBBZGQgdGhlIHNwZWNpZmllZCBudW1iZXIgb2YgZGF5cyB0byB0aGUgZ2l2ZW4gZGF0ZS5cbiAqXG4gKiBAcGFyYW0ge0RhdGV8TnVtYmVyfSBkYXRlIC0gdGhlIGRhdGUgdG8gYmUgY2hhbmdlZFxuICogQHBhcmFtIHtOdW1iZXJ9IGFtb3VudCAtIHRoZSBhbW91bnQgb2YgZGF5cyB0byBiZSBhZGRlZC4gUG9zaXRpdmUgZGVjaW1hbHMgd2lsbCBiZSByb3VuZGVkIHVzaW5nIGBNYXRoLmZsb29yYCwgZGVjaW1hbHMgbGVzcyB0aGFuIHplcm8gd2lsbCBiZSByb3VuZGVkIHVzaW5nIGBNYXRoLmNlaWxgLlxuICogQHJldHVybnMge0RhdGV9IC0gdGhlIG5ldyBkYXRlIHdpdGggdGhlIGRheXMgYWRkZWRcbiAqIEB0aHJvd3Mge1R5cGVFcnJvcn0gLSAyIGFyZ3VtZW50cyByZXF1aXJlZFxuICpcbiAqIEBleGFtcGxlXG4gKiAvLyBBZGQgMTAgZGF5cyB0byAxIFNlcHRlbWJlciAyMDE0OlxuICogY29uc3QgcmVzdWx0ID0gYWRkRGF5cyhuZXcgRGF0ZSgyMDE0LCA4LCAxKSwgMTApXG4gKiAvLz0+IFRodSBTZXAgMTEgMjAxNCAwMDowMDowMFxuICovXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBhZGREYXlzKGRpcnR5RGF0ZSwgZGlydHlBbW91bnQpIHtcbiAgcmVxdWlyZWRBcmdzKDIsIGFyZ3VtZW50cyk7XG4gIHZhciBkYXRlID0gdG9EYXRlKGRpcnR5RGF0ZSk7XG4gIHZhciBhbW91bnQgPSB0b0ludGVnZXIoZGlydHlBbW91bnQpO1xuICBpZiAoaXNOYU4oYW1vdW50KSkge1xuICAgIHJldHVybiBuZXcgRGF0ZShOYU4pO1xuICB9XG4gIGlmICghYW1vdW50KSB7XG4gICAgLy8gSWYgMCBkYXlzLCBuby1vcCB0byBhdm9pZCBjaGFuZ2luZyB0aW1lcyBpbiB0aGUgaG91ciBiZWZvcmUgZW5kIG9mIERTVFxuICAgIHJldHVybiBkYXRlO1xuICB9XG4gIGRhdGUuc2V0RGF0ZShkYXRlLmdldERhdGUoKSArIGFtb3VudCk7XG4gIHJldHVybiBkYXRlO1xufSIsImltcG9ydCB0b0ludGVnZXIgZnJvbSBcIi4uL19saWIvdG9JbnRlZ2VyL2luZGV4LmpzXCI7XG5pbXBvcnQgYWRkWWVhcnMgZnJvbSBcIi4uL2FkZFllYXJzL2luZGV4LmpzXCI7XG5pbXBvcnQgcmVxdWlyZWRBcmdzIGZyb20gXCIuLi9fbGliL3JlcXVpcmVkQXJncy9pbmRleC5qc1wiO1xuLyoqXG4gKiBAbmFtZSBzdWJZZWFyc1xuICogQGNhdGVnb3J5IFllYXIgSGVscGVyc1xuICogQHN1bW1hcnkgU3VidHJhY3QgdGhlIHNwZWNpZmllZCBudW1iZXIgb2YgeWVhcnMgZnJvbSB0aGUgZ2l2ZW4gZGF0ZS5cbiAqXG4gKiBAZGVzY3JpcHRpb25cbiAqIFN1YnRyYWN0IHRoZSBzcGVjaWZpZWQgbnVtYmVyIG9mIHllYXJzIGZyb20gdGhlIGdpdmVuIGRhdGUuXG4gKlxuICogQHBhcmFtIHtEYXRlfE51bWJlcn0gZGF0ZSAtIHRoZSBkYXRlIHRvIGJlIGNoYW5nZWRcbiAqIEBwYXJhbSB7TnVtYmVyfSBhbW91bnQgLSB0aGUgYW1vdW50IG9mIHllYXJzIHRvIGJlIHN1YnRyYWN0ZWQuIFBvc2l0aXZlIGRlY2ltYWxzIHdpbGwgYmUgcm91bmRlZCB1c2luZyBgTWF0aC5mbG9vcmAsIGRlY2ltYWxzIGxlc3MgdGhhbiB6ZXJvIHdpbGwgYmUgcm91bmRlZCB1c2luZyBgTWF0aC5jZWlsYC5cbiAqIEByZXR1cm5zIHtEYXRlfSB0aGUgbmV3IGRhdGUgd2l0aCB0aGUgeWVhcnMgc3VidHJhY3RlZFxuICogQHRocm93cyB7VHlwZUVycm9yfSAyIGFyZ3VtZW50cyByZXF1aXJlZFxuICpcbiAqIEBleGFtcGxlXG4gKiAvLyBTdWJ0cmFjdCA1IHllYXJzIGZyb20gMSBTZXB0ZW1iZXIgMjAxNDpcbiAqIGNvbnN0IHJlc3VsdCA9IHN1YlllYXJzKG5ldyBEYXRlKDIwMTQsIDgsIDEpLCA1KVxuICogLy89PiBUdWUgU2VwIDAxIDIwMDkgMDA6MDA6MDBcbiAqL1xuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gc3ViWWVhcnMoZGlydHlEYXRlLCBkaXJ0eUFtb3VudCkge1xuICByZXF1aXJlZEFyZ3MoMiwgYXJndW1lbnRzKTtcbiAgdmFyIGFtb3VudCA9IHRvSW50ZWdlcihkaXJ0eUFtb3VudCk7XG4gIHJldHVybiBhZGRZZWFycyhkaXJ0eURhdGUsIC1hbW91bnQpO1xufSIsImltcG9ydCB0b0ludGVnZXIgZnJvbSBcIi4uL19saWIvdG9JbnRlZ2VyL2luZGV4LmpzXCI7XG5pbXBvcnQgYWRkTW9udGhzIGZyb20gXCIuLi9hZGRNb250aHMvaW5kZXguanNcIjtcbmltcG9ydCByZXF1aXJlZEFyZ3MgZnJvbSBcIi4uL19saWIvcmVxdWlyZWRBcmdzL2luZGV4LmpzXCI7XG4vKipcbiAqIEBuYW1lIGFkZFllYXJzXG4gKiBAY2F0ZWdvcnkgWWVhciBIZWxwZXJzXG4gKiBAc3VtbWFyeSBBZGQgdGhlIHNwZWNpZmllZCBudW1iZXIgb2YgeWVhcnMgdG8gdGhlIGdpdmVuIGRhdGUuXG4gKlxuICogQGRlc2NyaXB0aW9uXG4gKiBBZGQgdGhlIHNwZWNpZmllZCBudW1iZXIgb2YgeWVhcnMgdG8gdGhlIGdpdmVuIGRhdGUuXG4gKlxuICogQHBhcmFtIHtEYXRlfE51bWJlcn0gZGF0ZSAtIHRoZSBkYXRlIHRvIGJlIGNoYW5nZWRcbiAqIEBwYXJhbSB7TnVtYmVyfSBhbW91bnQgLSB0aGUgYW1vdW50IG9mIHllYXJzIHRvIGJlIGFkZGVkLiBQb3NpdGl2ZSBkZWNpbWFscyB3aWxsIGJlIHJvdW5kZWQgdXNpbmcgYE1hdGguZmxvb3JgLCBkZWNpbWFscyBsZXNzIHRoYW4gemVybyB3aWxsIGJlIHJvdW5kZWQgdXNpbmcgYE1hdGguY2VpbGAuXG4gKiBAcmV0dXJucyB7RGF0ZX0gdGhlIG5ldyBkYXRlIHdpdGggdGhlIHllYXJzIGFkZGVkXG4gKiBAdGhyb3dzIHtUeXBlRXJyb3J9IDIgYXJndW1lbnRzIHJlcXVpcmVkXG4gKlxuICogQGV4YW1wbGVcbiAqIC8vIEFkZCA1IHllYXJzIHRvIDEgU2VwdGVtYmVyIDIwMTQ6XG4gKiBjb25zdCByZXN1bHQgPSBhZGRZZWFycyhuZXcgRGF0ZSgyMDE0LCA4LCAxKSwgNSlcbiAqIC8vPT4gU3VuIFNlcCAwMSAyMDE5IDAwOjAwOjAwXG4gKi9cbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIGFkZFllYXJzKGRpcnR5RGF0ZSwgZGlydHlBbW91bnQpIHtcbiAgcmVxdWlyZWRBcmdzKDIsIGFyZ3VtZW50cyk7XG4gIHZhciBhbW91bnQgPSB0b0ludGVnZXIoZGlydHlBbW91bnQpO1xuICByZXR1cm4gYWRkTW9udGhzKGRpcnR5RGF0ZSwgYW1vdW50ICogMTIpO1xufSIsImltcG9ydCB0b0ludGVnZXIgZnJvbSBcIi4uL19saWIvdG9JbnRlZ2VyL2luZGV4LmpzXCI7XG5pbXBvcnQgdG9EYXRlIGZyb20gXCIuLi90b0RhdGUvaW5kZXguanNcIjtcbmltcG9ydCByZXF1aXJlZEFyZ3MgZnJvbSBcIi4uL19saWIvcmVxdWlyZWRBcmdzL2luZGV4LmpzXCI7XG4vKipcbiAqIEBuYW1lIGFkZE1vbnRoc1xuICogQGNhdGVnb3J5IE1vbnRoIEhlbHBlcnNcbiAqIEBzdW1tYXJ5IEFkZCB0aGUgc3BlY2lmaWVkIG51bWJlciBvZiBtb250aHMgdG8gdGhlIGdpdmVuIGRhdGUuXG4gKlxuICogQGRlc2NyaXB0aW9uXG4gKiBBZGQgdGhlIHNwZWNpZmllZCBudW1iZXIgb2YgbW9udGhzIHRvIHRoZSBnaXZlbiBkYXRlLlxuICpcbiAqIEBwYXJhbSB7RGF0ZXxOdW1iZXJ9IGRhdGUgLSB0aGUgZGF0ZSB0byBiZSBjaGFuZ2VkXG4gKiBAcGFyYW0ge051bWJlcn0gYW1vdW50IC0gdGhlIGFtb3VudCBvZiBtb250aHMgdG8gYmUgYWRkZWQuIFBvc2l0aXZlIGRlY2ltYWxzIHdpbGwgYmUgcm91bmRlZCB1c2luZyBgTWF0aC5mbG9vcmAsIGRlY2ltYWxzIGxlc3MgdGhhbiB6ZXJvIHdpbGwgYmUgcm91bmRlZCB1c2luZyBgTWF0aC5jZWlsYC5cbiAqIEByZXR1cm5zIHtEYXRlfSB0aGUgbmV3IGRhdGUgd2l0aCB0aGUgbW9udGhzIGFkZGVkXG4gKiBAdGhyb3dzIHtUeXBlRXJyb3J9IDIgYXJndW1lbnRzIHJlcXVpcmVkXG4gKlxuICogQGV4YW1wbGVcbiAqIC8vIEFkZCA1IG1vbnRocyB0byAxIFNlcHRlbWJlciAyMDE0OlxuICogY29uc3QgcmVzdWx0ID0gYWRkTW9udGhzKG5ldyBEYXRlKDIwMTQsIDgsIDEpLCA1KVxuICogLy89PiBTdW4gRmViIDAxIDIwMTUgMDA6MDA6MDBcbiAqL1xuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gYWRkTW9udGhzKGRpcnR5RGF0ZSwgZGlydHlBbW91bnQpIHtcbiAgcmVxdWlyZWRBcmdzKDIsIGFyZ3VtZW50cyk7XG4gIHZhciBkYXRlID0gdG9EYXRlKGRpcnR5RGF0ZSk7XG4gIHZhciBhbW91bnQgPSB0b0ludGVnZXIoZGlydHlBbW91bnQpO1xuICBpZiAoaXNOYU4oYW1vdW50KSkge1xuICAgIHJldHVybiBuZXcgRGF0ZShOYU4pO1xuICB9XG4gIGlmICghYW1vdW50KSB7XG4gICAgLy8gSWYgMCBtb250aHMsIG5vLW9wIHRvIGF2b2lkIGNoYW5naW5nIHRpbWVzIGluIHRoZSBob3VyIGJlZm9yZSBlbmQgb2YgRFNUXG4gICAgcmV0dXJuIGRhdGU7XG4gIH1cbiAgdmFyIGRheU9mTW9udGggPSBkYXRlLmdldERhdGUoKTtcblxuICAvLyBUaGUgSlMgRGF0ZSBvYmplY3Qgc3VwcG9ydHMgZGF0ZSBtYXRoIGJ5IGFjY2VwdGluZyBvdXQtb2YtYm91bmRzIHZhbHVlcyBmb3JcbiAgLy8gbW9udGgsIGRheSwgZXRjLiBGb3IgZXhhbXBsZSwgbmV3IERhdGUoMjAyMCwgMCwgMCkgcmV0dXJucyAzMSBEZWMgMjAxOSBhbmRcbiAgLy8gbmV3IERhdGUoMjAyMCwgMTMsIDEpIHJldHVybnMgMSBGZWIgMjAyMS4gIFRoaXMgaXMgKmFsbW9zdCogdGhlIGJlaGF2aW9yIHdlXG4gIC8vIHdhbnQgZXhjZXB0IHRoYXQgZGF0ZXMgd2lsbCB3cmFwIGFyb3VuZCB0aGUgZW5kIG9mIGEgbW9udGgsIG1lYW5pbmcgdGhhdFxuICAvLyBuZXcgRGF0ZSgyMDIwLCAxMywgMzEpIHdpbGwgcmV0dXJuIDMgTWFyIDIwMjEgbm90IDI4IEZlYiAyMDIxIGFzIGRlc2lyZWQuIFNvXG4gIC8vIHdlJ2xsIGRlZmF1bHQgdG8gdGhlIGVuZCBvZiB0aGUgZGVzaXJlZCBtb250aCBieSBhZGRpbmcgMSB0byB0aGUgZGVzaXJlZFxuICAvLyBtb250aCBhbmQgdXNpbmcgYSBkYXRlIG9mIDAgdG8gYmFjayB1cCBvbmUgZGF5IHRvIHRoZSBlbmQgb2YgdGhlIGRlc2lyZWRcbiAgLy8gbW9udGguXG4gIHZhciBlbmRPZkRlc2lyZWRNb250aCA9IG5ldyBEYXRlKGRhdGUuZ2V0VGltZSgpKTtcbiAgZW5kT2ZEZXNpcmVkTW9udGguc2V0TW9udGgoZGF0ZS5nZXRNb250aCgpICsgYW1vdW50ICsgMSwgMCk7XG4gIHZhciBkYXlzSW5Nb250aCA9IGVuZE9mRGVzaXJlZE1vbnRoLmdldERhdGUoKTtcbiAgaWYgKGRheU9mTW9udGggPj0gZGF5c0luTW9udGgpIHtcbiAgICAvLyBJZiB3ZSdyZSBhbHJlYWR5IGF0IHRoZSBlbmQgb2YgdGhlIG1vbnRoLCB0aGVuIHRoaXMgaXMgdGhlIGNvcnJlY3QgZGF0ZVxuICAgIC8vIGFuZCB3ZSdyZSBkb25lLlxuICAgIHJldHVybiBlbmRPZkRlc2lyZWRNb250aDtcbiAgfSBlbHNlIHtcbiAgICAvLyBPdGhlcndpc2UsIHdlIG5vdyBrbm93IHRoYXQgc2V0dGluZyB0aGUgb3JpZ2luYWwgZGF5LW9mLW1vbnRoIHZhbHVlIHdvbid0XG4gICAgLy8gY2F1c2UgYW4gb3ZlcmZsb3csIHNvIHNldCB0aGUgZGVzaXJlZCBkYXktb2YtbW9udGguIE5vdGUgdGhhdCB3ZSBjYW4ndFxuICAgIC8vIGp1c3Qgc2V0IHRoZSBkYXRlIG9mIGBlbmRPZkRlc2lyZWRNb250aGAgYmVjYXVzZSB0aGF0IG9iamVjdCBtYXkgaGF2ZSBoYWRcbiAgICAvLyBpdHMgdGltZSBjaGFuZ2VkIGluIHRoZSB1bnVzdWFsIGNhc2Ugd2hlcmUgd2hlcmUgYSBEU1QgdHJhbnNpdGlvbiB3YXMgb25cbiAgICAvLyB0aGUgbGFzdCBkYXkgb2YgdGhlIG1vbnRoIGFuZCBpdHMgbG9jYWwgdGltZSB3YXMgaW4gdGhlIGhvdXIgc2tpcHBlZCBvclxuICAgIC8vIHJlcGVhdGVkIG5leHQgdG8gYSBEU1QgdHJhbnNpdGlvbi4gIFNvIHdlIHVzZSBgZGF0ZWAgaW5zdGVhZCB3aGljaCBpc1xuICAgIC8vIGd1YXJhbnRlZWQgdG8gc3RpbGwgaGF2ZSB0aGUgb3JpZ2luYWwgdGltZS5cbiAgICBkYXRlLnNldEZ1bGxZZWFyKGVuZE9mRGVzaXJlZE1vbnRoLmdldEZ1bGxZZWFyKCksIGVuZE9mRGVzaXJlZE1vbnRoLmdldE1vbnRoKCksIGRheU9mTW9udGgpO1xuICAgIHJldHVybiBkYXRlO1xuICB9XG59IiwiaW1wb3J0IHsgQ2hhcnQgfSBmcm9tIFwiY2hhcnQuanMvZGlzdFwiO1xyXG5pbXBvcnQgeyBTdHJhdmFBcGlDbGllbnQgfSBmcm9tIFwiLi9hcGlDbGllbnRcIjtcclxuaW1wb3J0IHsgQ2hhcnRHZW5lcmF0b3IgfSBmcm9tIFwiLi9jaGFydEdlbmVyYXRvclwiO1xyXG5pbXBvcnQgeyBIZWFydFJhdGVDaGFydEdlbmVyYXRvciB9IGZyb20gXCIuL2hlYXJ0UmF0ZUNoYXJ0R2VuZXJhdG9yXCI7XHJcbmltcG9ydCB7IERhdGFDYWxjdWxhdG9yIH0gZnJvbSBcIi4vZGF0YUNhbGN1bGF0b3JcIjtcclxuaW1wb3J0IHsgU3RyYXZhQWN0aXZpdHkgfSBmcm9tIFwiLi9tb2RlbHMvc3RyYXZhQWN0aXZpdHlcIjtcclxuaW1wb3J0IHsgU3RyZWFtIH0gZnJvbSBcIi4vbW9kZWxzL3N0cmVhbVwiO1xyXG5pbXBvcnQgKiBhcyBEYXRlSGVscGVyIGZyb20gXCJkYXRlLWZuc1wiO1xyXG5pbXBvcnQgeyBEZXRhaWxlZEFjdGl2aXR5IH0gZnJvbSBcIi4vbW9kZWxzL2RldGFpbGVkQWN0aXZpdHlcIjtcclxuXHJcblxyXG5hc3luYyBmdW5jdGlvbiBtYWluKCkge1xyXG4gICAgLy9sZXQgYnV0dG9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJzd2l0Y2hQb3dlclwiKSBhcyBIVE1MQnV0dG9uRWxlbWVudDtcclxuICAgIC8vbGV0IGhyQnV0dG9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJzd2l0Y2hIclwiKSBhcyBIVE1MQnV0dG9uRWxlbWVudDtcclxuXHJcbiAgICBsZXQgcG93ZXJUb2dnbGVDaGFydEJ1dHRvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiY29udmVydFBvd2VyXCIpIGFzIEhUTUxCdXR0b25FbGVtZW50O1xyXG4gICAgbGV0IGhyVG9nZ2xlQ2hhcnRCdXR0b24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImNvbnZlcnRIclwiKSBhcyBIVE1MQnV0dG9uRWxlbWVudDtcclxuXHJcbiAgICBsZXQgY2xpZW50ID0gbmV3IFN0cmF2YUFwaUNsaWVudCgpO1xyXG5cclxuICAgIHZhciBwb3dlclN0cmVhbXMgPSBhd2FpdCBjbGllbnQuZ2V0UG93ZXJEYXRhKCk7XHJcbiAgICB2YXIgaHJTdHJlYW1zID0gYXdhaXQgY2xpZW50LmdldEhlYXJ0UmF0ZURhdGEoKTtcclxuXHJcbiAgICB2YXIgYWN0aXZpdGllcyA9IGF3YWl0IGNsaWVudC5nZXRBY3Rpdml0aWVzKCk7XHJcblxyXG4gICAgdmFyIGRldGFpbGVkQWN0aXZpdGllcyA9IGF3YWl0IGNsaWVudC5nZXREZXRhaWxlZEFjdGl2aXRpZXMoKTtcclxuICAgIGNvbnNvbGUubG9nKGFjdGl2aXRpZXMpO1xyXG4gICAgY29uc29sZS5sb2coZGV0YWlsZWRBY3Rpdml0aWVzKTtcclxuICAgIGNvbnNvbGUubG9nKGhyU3RyZWFtcyk7XHJcbiAgICBjb25zb2xlLmxvZyhwb3dlclN0cmVhbXMpO1xyXG5cclxuICAgIC8qbGV0IHBvd2VyQ2hhcnRHZW5lcmF0b3IgPSBuZXcgUG93ZXJDaGFydEdlbmVyYXRvcihwb3dlclN0cmVhbXMpO1xyXG4gICAgcG93ZXJDaGFydEdlbmVyYXRvci5jcmVhdGVQaWVDaGFydCgpO1xyXG4gICAgLy9idXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHBvd2VyQ2hhcnRHZW5lcmF0b3IudG9nZ2xlVGltZVVuaXRzKCkpO1xyXG4gICAgcG93ZXJUb2dnbGVDaGFydEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4gcG93ZXJDaGFydEdlbmVyYXRvci50b2dnbGVDaGFydFR5cGUoKSk7XHJcblxyXG4gICAgbGV0IGhyQ2hhcnRHZW5lcmF0b3IgPSBuZXcgSGVhcnRSYXRlQ2hhcnRHZW5lcmF0b3IoaHJTdHJlYW1zLCBhY3Rpdml0aWVzKTtcclxuICAgIGhyQ2hhcnRHZW5lcmF0b3IuY3JlYXRlUGllQ2hhcnQoKTtcclxuICAgIC8vaHJCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IGhyQ2hhcnRHZW5lcmF0b3IudG9nZ2xlVGltZVVuaXRzKCkpO1xyXG4gICAgaHJUb2dnbGVDaGFydEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4gaHJDaGFydEdlbmVyYXRvci50b2dnbGVDaGFydFR5cGUoKSk7Ki9cclxuXHJcbiAgICBhZGRTdHJlYW1zVG9BY3Rpdml0eShwb3dlclN0cmVhbXMsIGhyU3RyZWFtcywgYWN0aXZpdGllcyk7XHJcbiAgICBhZGREZXRhaWxzVG9BY3Rpdml0eShhY3Rpdml0aWVzLCBkZXRhaWxlZEFjdGl2aXRpZXMpO1xyXG4gICAgY29uc29sZS5sb2coYWN0aXZpdGllcyk7XHJcbiAgICBsZXQgZGF0YUNhbGN1bGF0b3IgPSBuZXcgRGF0YUNhbGN1bGF0b3IoYWN0aXZpdGllcyk7XHJcbiAgICBkYXRhQ2FsY3VsYXRvci5zZXRUaW1lSW5ab25lTGlzdHMoKTtcclxuXHJcbiAgICBcclxuICAgIC8vZGF0YUNhbGN1bGF0b3IuZmlsdGVyQnlEYXRlKG5ldyBEYXRlKDIwMjMsIDApLnRvU3RyaW5nKCksIG5ldyBEYXRlKDIwMjMsIDYpLnRvU3RyaW5nKCkpO1xyXG4gICAgZGF0YUNhbGN1bGF0b3IuZmlsdGVyQnlEYXRlKERhdGVIZWxwZXIuc3ViRGF5cyhuZXcgRGF0ZSgpLCAzMCksIG5ldyBEYXRlKCkpO1xyXG4gICAgZGF0YUNhbGN1bGF0b3Iuc2V0Q2Fsb3JpZXNCdXJuZWQoKTtcclxuICAgIGNvbnNvbGUubG9nKGRhdGFDYWxjdWxhdG9yLmNhbG9yaWVzQnVybmVkSW5UaW1lUGVyaW9kKTtcclxuICAgIC8vY29uc29sZS5sb2coZmlsdGVyZWQzMGRheXMpO1xyXG4gICAgZGF0YUNhbGN1bGF0b3IuZmlsdGVyQnlEYXRlKERhdGVIZWxwZXIuc3ViRGF5cyhuZXcgRGF0ZSgpLCA5MCksIG5ldyBEYXRlKCkpO1xyXG4gICAgbGV0IGZpbHRlcmVkOTBkYXlzID0gZGF0YUNhbGN1bGF0b3IuaHJUaW1lSW5ab25lO1xyXG4gICAgY29uc29sZS5sb2coXCJBZnRlciA5MCBkYXlzIGZpbHRlclwiKTtcclxuICAgIGRhdGFDYWxjdWxhdG9yLnNldENhbG9yaWVzQnVybmVkKCk7XHJcbiAgICBjb25zb2xlLmxvZyhkYXRhQ2FsY3VsYXRvci5jYWxvcmllc0J1cm5lZEluVGltZVBlcmlvZCk7XHJcbiAgICBjb25zb2xlLmxvZyhmaWx0ZXJlZDkwZGF5cyk7XHJcbiAgICBkYXRhQ2FsY3VsYXRvci5maWx0ZXJCeURhdGUoRGF0ZUhlbHBlci5zdWJZZWFycyhuZXcgRGF0ZSgpLCAxKSwgbmV3IERhdGUoKSk7XHJcbiAgICBsZXQgZmlsdGVyZWQxeWVhciA9IGRhdGFDYWxjdWxhdG9yLmhyVGltZUluWm9uZTtcclxuICAgIGNvbnNvbGUubG9nKFwiQWZ0ZXIgMSB5ZWFyIGZpbHRlclwiKTtcclxuICAgIGRhdGFDYWxjdWxhdG9yLnNldENhbG9yaWVzQnVybmVkKCk7XHJcbiAgICBjb25zb2xlLmxvZyhkYXRhQ2FsY3VsYXRvci5jYWxvcmllc0J1cm5lZEluVGltZVBlcmlvZCk7XHJcbiAgICBjb25zb2xlLmxvZyhmaWx0ZXJlZDF5ZWFyKTtcclxuICAgIGRhdGFDYWxjdWxhdG9yLmZpbHRlckJ5RGF0ZShEYXRlSGVscGVyLnN1YlllYXJzKG5ldyBEYXRlKCksIDUpLCBuZXcgRGF0ZSgpKTtcclxuICAgIGxldCBmaWx0ZXJlZEFsbFRpbWUgPSBkYXRhQ2FsY3VsYXRvci5oclRpbWVJblpvbmU7XHJcbiAgICBjb25zb2xlLmxvZyhcIkFsbCB0aW1lXCIpO1xyXG4gICAgZGF0YUNhbGN1bGF0b3Iuc2V0Q2Fsb3JpZXNCdXJuZWQoKTtcclxuICAgIGNvbnNvbGUubG9nKGRhdGFDYWxjdWxhdG9yLmNhbG9yaWVzQnVybmVkSW5UaW1lUGVyaW9kKTtcclxuICAgIGNvbnNvbGUubG9nKGZpbHRlcmVkQWxsVGltZSk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGFkZFN0cmVhbXNUb0FjdGl2aXR5KHBvd2VyU3RyZWFtczogU3RyZWFtW10sIGhyU3RyZWFtczogU3RyZWFtW10sIGFjdGl2aXRpZXM6IFN0cmF2YUFjdGl2aXR5W10pIHtcclxuICAgIGZvciAobGV0IGFjdGl2aXR5IG9mIGFjdGl2aXRpZXMpIHtcclxuICAgICAgICBsZXQgaHJTdHJlYW1XaXRoSWQgPSBoclN0cmVhbXMuZmluZChzdHJlYW0gPT4gc3RyZWFtLmlkID09IGFjdGl2aXR5LmlkKTtcclxuICAgICAgICBsZXQgcG93ZXJTdHJlYW1XaXRoSWQgPSBwb3dlclN0cmVhbXMuZmluZChzdHJlYW0gPT4gc3RyZWFtLmlkID09IGFjdGl2aXR5LmlkKTtcclxuICAgICAgICBhY3Rpdml0eS5wb3dlclN0cmVhbSA9IHBvd2VyU3RyZWFtV2l0aElkPy5wb3dlckRpY3Q7XHJcbiAgICAgICAgYWN0aXZpdHkuaHJTdHJlYW0gPSBoclN0cmVhbVdpdGhJZD8uaGVhcnRSYXRlRGljdDtcclxuICAgIH1cclxufVxyXG5cclxuZnVuY3Rpb24gYWRkRGV0YWlsc1RvQWN0aXZpdHkoYWN0aXZpdGllczogU3RyYXZhQWN0aXZpdHlbXSwgZGV0YWlsZWRBY3Rpdml0aWVzIDogRGV0YWlsZWRBY3Rpdml0eVtdKSB7XHJcbiAgICBmb3IgKGxldCBhY3Rpdml0eSBvZiBhY3Rpdml0aWVzKSB7XHJcbiAgICAgICAgbGV0IGRldGFpbHMgPSBkZXRhaWxlZEFjdGl2aXRpZXMuZmluZChlID0+IGUuaWQgPT0gYWN0aXZpdHkuaWQpO1xyXG4gICAgICAgIGFjdGl2aXR5LmRldGFpbHMgPSBkZXRhaWxzO1xyXG4gICAgfVxyXG59XHJcblxyXG4oYXN5bmMgKCkgPT4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgICBhd2FpdCBtYWluKCk7XHJcbiAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcihlKTtcclxuICAgIH1cclxufSkoKTtcclxuIl0sIm5hbWVzIjpbImdldFBvd2VyRGF0YSIsImZldGNoIiwianNvbiIsImdldEhlYXJ0UmF0ZURhdGEiLCJnZXRBY3Rpdml0aWVzIiwiZ2V0RGV0YWlsZWRBY3Rpdml0aWVzIiwiX3R5cGVvZiIsIm9iaiIsIlN5bWJvbCIsIml0ZXJhdG9yIiwiY29uc3RydWN0b3IiLCJwcm90b3R5cGUiLCJyZXF1aXJlZEFyZ3MiLCJyZXF1aXJlZCIsImFyZ3MiLCJsZW5ndGgiLCJUeXBlRXJyb3IiLCJ0b0RhdGUiLCJhcmd1bWVudCIsImFyZ3VtZW50cyIsImFyZ1N0ciIsIk9iamVjdCIsInRvU3RyaW5nIiwiY2FsbCIsIkRhdGUiLCJnZXRUaW1lIiwiY29uc29sZSIsIndhcm4iLCJFcnJvciIsInN0YWNrIiwiTmFOIiwiaXNBZnRlciIsImRpcnR5RGF0ZSIsImRpcnR5RGF0ZVRvQ29tcGFyZSIsImRhdGUiLCJkYXRlVG9Db21wYXJlIiwiaXNCZWZvcmUiLCJnZXRUaW1lSW5ab25lTGlzdCIsImFjdGl2aXRpZXMiLCJ0aW1lSW5ab25lRGljdCIsImFjdGl2aXR5Iiwia2V5IiwicG93ZXJTdHJlYW0iLCJ0aW1lQXRQb3dlckluU2Vjb25kcyIsInRoaXMiLCJnZXRab25lIiwiTnVtYmVyIiwicGFyc2VJbnQiLCJ2YWx1ZXMiLCJwb3dlciIsInBvd2VyQXNOdW1iZXIiLCJzZXRQb3dlclpvbmVzIiwiZnRwIiwicG93ZXJab25lcyIsImhyU3RyZWFtIiwiaGVhcnRSYXRlIiwic2V0SHJab25lcyIsIm1heEhyIiwiaHJab25lcyIsImFsbEFjdGl2aXRpZXMiLCJmaWx0ZXJlZEFjdGl2aXRpZXMiLCJmaWx0ZXJCeURhdGUiLCJmcm9tRGF0ZSIsImFjdGl2aXR5RGF0ZSIsInBhcnNlIiwic3RhcnRfZGF0ZV9sb2NhbCIsInB1c2giLCJzZXRUaW1lSW5ab25lTGlzdHMiLCJwb3dlclRpbWVJblpvbmUiLCJQb3dlclpvbmUiLCJoclRpbWVJblpvbmUiLCJIclpvbmUiLCJzZXRDYWxvcmllc0J1cm5lZCIsImNhbG9yaWVzQnVybmVkSW5UaW1lUGVyaW9kIiwiZGV0YWlscyIsImNhbG9yaWVzIiwidG9JbnRlZ2VyIiwiZGlydHlOdW1iZXIiLCJudW1iZXIiLCJpc05hTiIsIk1hdGgiLCJjZWlsIiwiZmxvb3IiLCJzdWJEYXlzIiwiZGlydHlBbW91bnQiLCJhbW91bnQiLCJzZXREYXRlIiwiZ2V0RGF0ZSIsImFkZERheXMiLCJzdWJZZWFycyIsImRheU9mTW9udGgiLCJlbmRPZkRlc2lyZWRNb250aCIsInNldE1vbnRoIiwiZ2V0TW9udGgiLCJzZXRGdWxsWWVhciIsImdldEZ1bGxZZWFyIiwiYWRkTW9udGhzIiwiYWRkWWVhcnMiLCJtYWluIiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsImNsaWVudCIsIlN0cmF2YUFwaUNsaWVudCIsInBvd2VyU3RyZWFtcyIsImhyU3RyZWFtcyIsImRldGFpbGVkQWN0aXZpdGllcyIsImxvZyIsImhyU3RyZWFtV2l0aElkIiwiZmluZCIsInN0cmVhbSIsImlkIiwicG93ZXJTdHJlYW1XaXRoSWQiLCJwb3dlckRpY3QiLCJoZWFydFJhdGVEaWN0IiwiYWRkU3RyZWFtc1RvQWN0aXZpdHkiLCJlIiwiYWRkRGV0YWlsc1RvQWN0aXZpdHkiLCJkYXRhQ2FsY3VsYXRvciIsIkRhdGFDYWxjdWxhdG9yIiwiZmlsdGVyZWQ5MGRheXMiLCJmaWx0ZXJlZDF5ZWFyIiwiZmlsdGVyZWRBbGxUaW1lIiwiZXJyb3IiXSwic291cmNlUm9vdCI6IiJ9